jQuery ->
  form = $('form')

  $(':input').each (_, el) ->
    $(el).data('original', $(el).val())

  $(':input').blur ->
    return unless $(this).val() != $(this).data('original')

    $(this).data('original', $(this).val())
    $(this).next('img').remove()

    img = $(ajaxSmall)
    img.insertAfter(this)

    data = {_method: 'put'}
    data[$(this).prop('name')] = $(this).val()

    $.ajax
      url: form.attr('action')
      type: form.attr('method')
      data: data
      dataType: 'json'
      success: ->
        img.prop 'src', "<%= asset_path 'icon/accept.png' %>"
        setTimeout (-> img.fadeOut -> img.remove()), 2000
      error: -> img.prop 'src', "<%= asset_path 'icon/exclamation.png' %>"
